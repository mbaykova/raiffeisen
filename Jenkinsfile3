#!groovy

node('master') {

    stage('Checkout') {
        checkout scm
    }

//    def externalMethod = load("externalMethod.groovy")
//
//    // Call the method we defined in externalMethod.
//    externalMethod.lookAtThis("Steve")

    // Now load 'externalCall.groovy'.
    def externalCall = load("externalCall.groovy")

    // We can just run it with "externalCall(...)" since it has a call method.
    externalCall("Steve")



    stage('Run tests') {
        try{
            withMaven(maven: 'Maven3') {
                sh 'mvn clean install'
            }
        }  catch (e) {
            currentBuild.result = 'FAILURE'
            throw e
        }finally {
            stage('Reports') {
                allure([
                        includeProperties: false,
                        jdk: '',
                        properties: [],
                        reportBuildPolicy: 'ALWAYS',
                        results: [[path: 'target/allure-results']]
                ])
            }
        }

    }

}